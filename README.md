# Viral Proteins Clusters Host Analysis - Sequence Based

## Description
This repository contians the following:
- Methodolgy for:
    - Extracting taxonomical and annotation data of viral proteins and the their hosts.
    - Use previous protein clusters to find clusters with viruses that infect multiple domains of life (Prokaryotes, Eukaryotes, Archaea and Viruses). They are called hetro cell clusters.
    - Analyze protein clusters according to taxonomy.
    - Download and curate required data for the above. 
- Tabular files for clusters, proteins, taxonomy and annotations.
- Python scripts:
    1- get_hetro_cell_clusters.py: Main part to find interesting clusters where members collectively infect multiple life domains.
    2- annotate_hetro_clusters.py: Uses Entrez to get annotations of the hetro cell viral protein clusters. 
    3- analyze_hetro_clusters.py: Produces cluster-wise hetrogeniety analysis.
    4- vp_interactions_plots.py: Generates statistical plots.
For this work the following resources were used:
	- NCBI Protein database: to download viral protein accns and taxonomic ids.
	    https://www.ncbi.nlm.nih.gov/protein/
	- Virus-Host DB: to get taxonomy of viruses and their hosts. 
		https://www.genome.jp/virushostdb/


## Methodology

### Downloading and Curating viral protein taxonomy IDs.

This is done by manually filtering the viral proteins in NCBI as follows: txid10239[Organism] AND (pdb[filter] OR refseq[filter]). Then download all of them in tinyxml format other formats can be used as long as it has the tax id. Please note that we are ignoring AFDB in this step as it has only 39 proteins.

NOTE:Downloaded on 31st of May 2023 for a total of 749600 viral proteins with a file name 'sequence.fasta.xml'.
The below is the curating and extracting steps: 

\# Remove the lines with gnl sequence ids(to ease out the following steps):

	$cat sequence.fasta.xml | grep -v 'gnl|' > seqs_gnl_corrected.xml

\# Extract protein accns only with the following command and write to a tsv file:

	$cat seqs_gnl_corrected.xml | grep -B1  taxid |grep -v taxid|sed 's/<[^>]*>//g'| grep -v -|tr -d ' '|sed 's/pdb|//'|tr '|' '_' > accns_corrected.tsv  

\# Extract taxids corresponding to accessions with the following command:

	$cat seqs_gnl_corrected.xml| grep  taxid |sed 's/<[^>]*>//g'| grep -v - |tr -d ' ' > tax_corrected.tsv


\# concatenate both files horizontally. Two columns with one column for protein ACCN and the 2nd is for the tax id of its virus.

	$paste accns_corrected.tsv tax_corrected.tsv  > accn_tax_corrected.tsv


### Hetro Life Domains Viral Protein Clusters

Using the script 'get_hetro_cell_clusters.py' and the below files, hetro cell clusters were identified and extracted.
    1- 'accn_tax_corrected.tsv' (generated above)
    2- 'vp_clusters_cluster.tsv' (generated by sequence clustering with mmseq)
    3- 'virushostdb.tsv' (downloaded from https://www.genome.jp/ftp/db/virushostdb/)

Results are written to the following files:
- 'all_clusters_host_tax.tsv': Tabular file contains the columns for all viral proteins host interactions cluster_rep_accn, member_accn, viral_tax_ID, virus name, virus lineage, DISEASE(if any), host tax id, host name, host lineage, host_cell(life domain), host_lineage(without life domain)
- 'hetro_cell_clusters.tsv' :  Same as previous but only for hetro cell clusters.
- 'hetro_host_clusters.tsv': Same as above but for clusters spanning multiple host (even if the hosts are in the same life domain)

### Annotating Hetro Cell Clusters

Using the script 'annotate_hetro_clusters.py', the file hetro_cell_clusters.tsv is enriched with the NCBI annotation for every protein entry.
This is helpful to read the annotation for proteins belonging to the same clusters.
The result is written to the file : 'hetro_seq_clusters_annotations.tsv'

### Hetro Cluster Analysis

We now know the clusters that are life-domain heterogeneous. However, it is required to know how hetro are they? How many life domains do they cover? Is it only one protein that is making it hetro(maybe small error) or it is more than that.
With the script 'analyze_hetro_clusters.py', hetro clusters are analyzed and the results are written to the file: 'hetro_cell_cluster_analysis.tsv'

### 

The script 'vp_interactions_plots.py' is used to produce summaries of the results above in plots (mainly histograms).
/home/tamim/Documents/fsProject/VP_Host_Analysis/viral_host_jp/viral_entries_host_distribution.png
/home/tamim/Documents/fsProject/VP_Host_Analysis/viral_host_jp/hetro_clus_interactions_hist.png
/home/tamim/Documents/fsProject/VP_Host_Analysis/viral_host_jp/Host_Hetrogeniety_Hist.png
